name: Update GitBook Knowledge Base

on:
  schedule:
    - cron: '0 2 * * *' # 每天凌晨 2 点运行
  workflow_dispatch:

permissions:
  contents: write

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.22'

      - name: Install & Run
        run: |
          go mod init customcrops-scraper || true
          go get github.com/gocolly/colly/v2
          go get github.com/JohannesKaufmann/html-to-markdown
          
          # 清理旧数据，防止死链残留
          rm -rf knowledge_base/*.md
          
          go run main.go

      - name: Commit Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: update knowledge base from GitBook"
          file_pattern: 'knowledge_base/*.md'
